(()=>{"use strict";var __webpack_modules__={"./src/scripts/modules/lyricsParse.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   lyricsParse: () => (/* binding */ lyricsParse)\n/* harmony export */ });\nconst lyricsParse=text=>{const lyricOutput=[];const lyricTimestamp=/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g;for(const raw of text.split(/\\r?\\n/)){const lyricLine=raw.trim();if(!lyricLine)continue;lyricTimestamp.lastIndex=0;let lyricMinute;let lyricLastIndex=0;const lyricTime=[];while((lyricMinute=lyricTimestamp.exec(lyricLine))!==null){const timeMinute=parseInt(lyricMinute[1],10);const timeSecond=parseInt(lyricMinute[2],10);const timeMilisecond=lyricMinute[3]?parseInt((lyricMinute[3]+'00').slice(0,3),10):0;lyricTime.push((timeMinute*60+timeSecond)*1000+timeMilisecond);lyricLastIndex=lyricTimestamp.lastIndex;}const lyricContentRaw=lyricLine.slice(lyricLastIndex).trim();const lyricContent=lyricContentRaw.length?lyricContentRaw.charAt(0).toUpperCase()+lyricContentRaw.slice(1):lyricContentRaw;if(lyricTime.length){for(const t of lyricTime){lyricOutput.push({timeMs:t,text:lyricContent});}}}lyricOutput.sort((a,b)=>a.timeMs-b.timeMs);return lyricOutput;};\n\n//# sourceURL=webpack://lyrics-player/./src/scripts/modules/lyricsParse.js?\n}")},"./src/scripts/modules/lyricsRender.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   lyricsGetAudio: () => (/* binding */ lyricsGetAudio),\n/* harmony export */   lyricsRender: () => (/* binding */ lyricsRender),\n/* harmony export */   lyricsRenderHeaderFooter: () => (/* binding */ lyricsRenderHeaderFooter),\n/* harmony export */   lyricsRenderLoop: () => (/* binding */ lyricsRenderLoop)\n/* harmony export */ });\n/* harmony import */ var _script__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../script */ \"./src/scripts/script.js\");\n/* harmony import */ var _lyricsRenderSpectrum__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lyricsRenderSpectrum */ \"./src/scripts/modules/lyricsRenderSpectrum.js\");\nconst lyricsRender=(nowMs,drawContext)=>{const elementTextareaHeader=document.querySelector(_script__WEBPACK_IMPORTED_MODULE_0__.settings.elementTextareaHeader);const elementTextareaFooter=document.querySelector(_script__WEBPACK_IMPORTED_MODULE_0__.settings.elementTextareaFooter);const elementAudio=document.querySelector(_script__WEBPACK_IMPORTED_MODULE_0__.settings.elementAudio);const renderOffset=(parseFloat(document.querySelector(_script__WEBPACK_IMPORTED_MODULE_0__.settings.elementInputOffset).value)||0)*1000;const renderTime=nowMs+renderOffset;drawContext.clearRect(0,0,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight);if(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsBackground){try{drawContext.drawImage(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsBackground.el,0,0,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight);}catch(error){console.log('Error drawing background:',error);}drawContext.fillStyle='rgba(0, 0, 0, 0.12)';drawContext.fillRect(0,0,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight);}if(!_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed.length){drawContext.fillStyle='#000';drawContext.font=`76px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`;drawContext.textAlign='center';drawContext.textBaseline='middle';drawContext.fillText('â€”',_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight/2);return;}let renderIndexActiveLine=-1;for(let index=0;index<_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed.length;index++){if(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[index].timeMs<=renderTime){renderIndexActiveLine=index;}else{break;}}if(renderIndexActiveLine<0){renderIndexActiveLine=0;};const renderCurrentStart=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine].timeMs;const renderCurrentEnd=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine+1]?_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine+1].timeMs:elementAudio.duration*1000;const renderActiveProgress=Math.max(0,Math.min(1,(renderTime-renderCurrentStart)/(renderCurrentEnd-renderCurrentStart)));const renderLineSpacing=120;const renderBaseActiveY=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight*0.55;const renderBasePrevY=renderBaseActiveY-renderLineSpacing;const renderBaseNextY=renderBaseActiveY+renderLineSpacing;const renderScrollOffset=renderActiveProgress*renderLineSpacing;const renderPrevY=renderBasePrevY-renderScrollOffset;const renderActiveY=renderBaseActiveY-renderScrollOffset;const renderNextY=renderBaseNextY-renderScrollOffset;drawContext.textAlign='center';drawContext.textBaseline='middle';const renderActiveText=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine]?_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine].text:'';const renderPrevText=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine-1]?_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine-1].text:'';const renderNextText=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine+1]?_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsParsed[renderIndexActiveLine+1].text:'';let renderPrevAlpha=1;if(renderPrevText){if(renderActiveText.includes(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsInstrumentalText)){const renderFadeSpeed=0.1;renderPrevAlpha=Math.max(0,Math.min(1,1-renderActiveProgress/renderFadeSpeed));}else{renderPrevAlpha=1-renderActiveProgress;}const isItalicPrev=/^\\(.*\\)$/.test(renderPrevText);drawContext.font=`${isItalicPrev?\"italic \":\"\"}82px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`;drawContext.fillStyle='#fff';drawContext.globalAlpha=renderPrevAlpha;drawContext.fillText(renderPrevText,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,renderPrevY);}const isItalicActive=/^\\(.*\\)$/.test(renderActiveText);drawContext.font=`${isItalicActive?\"italic \":\"\"}82px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`;drawContext.fillStyle='#ffde59';drawContext.globalAlpha=1.0;drawContext.fillText(renderActiveText,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,renderActiveY);let renderNextAlpha=renderActiveProgress;if(renderActiveText.includes(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsInstrumentalText)){const renderRemaining=renderCurrentEnd-renderTime;const renderFadeDuration=Math.min(500,renderCurrentEnd-renderCurrentStart);renderNextAlpha=renderRemaining<renderFadeDuration?1-renderRemaining/renderFadeDuration:0;}if(renderNextText){const isItalicNext=/^\\(.*\\)$/.test(renderNextText);drawContext.font=`${isItalicNext?\"italic \":\"\"}82px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`;drawContext.fillStyle='#fff';drawContext.globalAlpha=renderNextAlpha;drawContext.fillText(renderNextText,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,renderNextY);}if(elementTextareaHeader&&elementTextareaHeader.value.trim()){const headerLines=elementTextareaHeader.value.split(/\\r?\\n/).map(l=>l.trim()).filter(Boolean);lyricsRenderHeaderFooter(drawContext,headerLines,renderTime,{font:`48px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`,x:_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,y:120,baseline:'top'},'lyricsHeaderFirstRender');}if(elementTextareaFooter&&elementTextareaFooter.value.trim()){const footerLines=elementTextareaFooter.value.split(/\\r?\\n/).map(l=>l.trim()).filter(Boolean);lyricsRenderHeaderFooter(drawContext,footerLines,renderTime,{font:`32px \"${_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsFont}\", Inter, sans-serif`,x:_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2,y:_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight-120,baseline:'bottom'},'lyricsHeaderFirstRender');}if(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsRenderSpectrum){drawContext.globalAlpha=1.0;(0,_lyricsRenderSpectrum__WEBPACK_IMPORTED_MODULE_1__.lyricsRenderSpectrum)(drawContext);}window.lyricsHeaderFirstRender=true;drawContext.globalAlpha=1.0;};const lyricsGetAudio=audio=>{return new Promise((res,rej)=>{if(audio.readyState>=2){return res();};function onloaded(){cleanup();res();}function onerr(){cleanup();rej(new Error('Cannot load audio'));}function cleanup(){audio.removeEventListener('canplay',onloaded);audio.removeEventListener('error',onerr);}audio.addEventListener('canplay',onloaded);audio.addEventListener('error',onerr);});};const lyricsRenderHeaderFooter=(drawContext,lines,nowMs,opts,firstRenderFlagName)=>{if(!lines||!lines.length)return;drawContext.font=opts.font;drawContext.textAlign='center';drawContext.textBaseline=opts.baseline;if(lines.length===1){drawContext.fillStyle='#fff';drawContext.globalAlpha=1;drawContext.fillText(lines[0],opts.x,opts.y);drawContext.globalAlpha=1;return;}const nowSec=nowMs/1000;const lineDuration=opts.lineDuration||6;const totalLines=lines.length;const idx=Math.floor(nowSec/lineDuration)%totalLines;const progress=nowSec%lineDuration/lineDuration;const fadeZone=0.2;let alpha=0.5;if(!window[firstRenderFlagName]){if(progress<fadeZone){alpha=progress/fadeZone;}else if(progress>1-fadeZone){alpha=(1-progress)/fadeZone;}}const color=idx%2===0?'#ffde59':'#fff';drawContext.fillStyle=color;drawContext.globalAlpha=alpha;drawContext.fillText(lines[idx],opts.x,opts.y);drawContext.globalAlpha=0.5;if(window[firstRenderFlagName]){window[firstRenderFlagName]=false;}};const lyricsRenderLoop=()=>{const elementAudio=document.querySelector(_script__WEBPACK_IMPORTED_MODULE_0__.settings.elementAudio);lyricsRender(elementAudio.currentTime*1000,_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsContext);_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsRequestAnimationFrameID=requestAnimationFrame(lyricsRenderLoop);};\n\n//# sourceURL=webpack://lyrics-player/./src/scripts/modules/lyricsRender.js?\n}")},"./src/scripts/modules/lyricsRenderSpectrum.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   lyricsRenderAnalyzer: () => (/* binding */ lyricsRenderAnalyzer),\n/* harmony export */   lyricsRenderSpectrum: () => (/* binding */ lyricsRenderSpectrum)\n/* harmony export */ });\n/* harmony import */ var _script__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../script */ "./src/scripts/script.js");\nconst lyricsRenderSpectrum=drawContext=>{if(!_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser||!_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumFrequencyData)return;_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser.getByteFrequencyData(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumFrequencyData);const barsNumber=80;const binSize=Math.floor(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumFrequencyData.length/barsNumber);const barGap=3;const barWidth=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2/barsNumber;const spectrumHeight=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight*0.12;const baseY=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewHeight;const barThresold=5;const gradient=drawContext.createLinearGradient(0,baseY,0,baseY-spectrumHeight);gradient.addColorStop(0,"rgba(255,222,89,0.1)");gradient.addColorStop(1,"rgba(255,222,89,0.9)");drawContext.fillStyle=gradient;for(let i=0;i<barsNumber;i++){let max=0;for(let j=0;j<binSize;j++){const v=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumFrequencyData[i*binSize+j];if(v>max)max=v;}let avg=max;if(avg<barThresold)avg=0;const scale=1-i/(barsNumber-1)*0.98;const barHeight=avg/255*spectrumHeight*scale;const xLeft=i*barWidth;const y=baseY-barHeight;drawContext.fillRect(xLeft,y,barWidth-barGap,barHeight);const xRight=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsPreviewWidth/2+(barsNumber-i-1)*barWidth;drawContext.fillRect(xRight,y,barWidth-barGap,barHeight);}};const lyricsRenderAnalyzer=audioEl=>{if(!_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext){_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext=new AudioContext();_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext.createAnalyser();_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser.fftSize=1024;_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser.smoothingTimeConstant=0.1;_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumSource=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext.createMediaElementSource(audioEl);const bassFilter=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext.createBiquadFilter();bassFilter.type=\'lowshelf\';bassFilter.frequency.value=150;bassFilter.gain.value=6;const gainNode=_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext.createGain();gainNode.gain.value=1.0;_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumSource.connect(bassFilter);bassFilter.connect(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser);_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser.connect(gainNode);gainNode.connect(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAudioContext.destination);_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumFrequencyData=new Uint8Array(_script__WEBPACK_IMPORTED_MODULE_0__.settings.lyricsSpectrumAnalyser.frequencyBinCount);}};\n\n//# sourceURL=webpack://lyrics-player/./src/scripts/modules/lyricsRenderSpectrum.js?\n}')},"./src/scripts/script.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   settings: () => (/* binding */ settings)\n/* harmony export */ });\n/* harmony import */ var _modules_lyricsParse__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modules/lyricsParse */ \"./src/scripts/modules/lyricsParse.js\");\n/* harmony import */ var _modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modules/lyricsRender */ \"./src/scripts/modules/lyricsRender.js\");\n/* harmony import */ var _modules_lyricsRenderSpectrum__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./modules/lyricsRenderSpectrum */ \"./src/scripts/modules/lyricsRenderSpectrum.js\");\nconst settings={elementInputAudio:'.element_input_audio',elementInputOffset:'.element_input_offset',elementInputBackground:'.element_input_background',elementInputSpectrum:'.element_input_spectrum',elementTextareaLyrics:'.element_textarea_lyrics',elementTextareaHeader:'.element_textarea_header',elementTextareaFooter:'.element_textarea_footer',elementButtonExport:'.element_button_export',elementButtonFullscreen:'.element_button_fullscreen',elementAudio:'.element_audio',elementContainerControll:'.element_container_controll',elementCanvas:'.element_canvas_preview',lyricsParsed:[],lyricsIsPlaying:false,lyricsIsRecording:false,lyricsRenderSpectrum:true,lyricsBackground:null,lyricsRequestAnimationFrameID:null,lyricsSpectrumAudioContext:null,lyricsSpectrumAnalyser:null,lyricsSpectrumSource:null,lyricsSpectrumFrequencyData:null,lyricsContext:null,lyricsPreviewWidth:1920,lyricsPreviewHeight:1080,lyricsFPS:60,lyricsFont:'Nexa Black',lyricsInstrumentalText:'â™ª',lyricsFileName:'lyrics-export'};const elementInputOffset=document.querySelector(settings.elementInputOffset);const elementInputSpectrum=document.querySelector(settings.elementInputSpectrum);const elementInputBackground=document.querySelector(settings.elementInputBackground);const elementInputAudio=document.querySelector(settings.elementInputAudio);const elementTextareaLyrics=document.querySelector(settings.elementTextareaLyrics);const elementTextareaHeader=document.querySelector(settings.elementTextareaHeader);const elementTextareaFooter=document.querySelector(settings.elementTextareaFooter);const elementButtonExport=document.querySelector(settings.elementButtonExport);const elementButtonFullscreen=document.querySelector(settings.elementButtonFullscreen);const elementAudio=document.querySelector(settings.elementAudio);const elementContainerControll=document.querySelector(settings.elementContainerControll);const elementCanvas=document.querySelector(settings.elementCanvas);settings.lyricsContext=elementCanvas.getContext('2d',{alpha:true});const storageSave=(key,value)=>{localStorage.setItem(key,value);};const storageLoad=function(key){let fallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';return localStorage.getItem(key)??fallback;};elementTextareaLyrics.value=storageLoad('lyrics_textarea','[00:00.00] Intro\\n[00:05.00] First lyric line\\n[00:10.00] Second lyric line\\n[00:15.00] Third lyric line');settings.lyricsParsed=(0,_modules_lyricsParse__WEBPACK_IMPORTED_MODULE_0__.lyricsParse)(elementTextareaLyrics.value);elementTextareaHeader.value=storageLoad('lyrics_header','');elementTextareaFooter.value=storageLoad('lyrics_footer','');(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(0,settings.lyricsContext);elementInputAudio.addEventListener('change',event=>{const file=event.target.files&&event.target.files[0];if(!file){return;};elementAudio.src=URL.createObjectURL(file);elementAudio.load();(0,_modules_lyricsRenderSpectrum__WEBPACK_IMPORTED_MODULE_2__.lyricsRenderAnalyzer)(elementAudio);settings.lyricsFileName=`${file.name.replace(/\\.[^/.]+$/,'')}`;});elementButtonFullscreen.addEventListener('click',event=>{if(!document.fullscreenElement){elementCanvas.requestFullscreen().catch(console.error);}else{document.exitFullscreen();}});elementAudio.addEventListener('loadedmetadata',()=>{elementContainerControll.classList.add('grid');elementContainerControll.classList.remove('hidden');});elementTextareaLyrics.addEventListener('input',()=>{settings.lyricsParsed=(0,_modules_lyricsParse__WEBPACK_IMPORTED_MODULE_0__.lyricsParse)(elementTextareaLyrics.value);(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);storageSave('lyrics_textarea',elementTextareaLyrics.value);});elementTextareaHeader.addEventListener('input',()=>{if(!settings.lyricsIsPlaying){(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);}storageSave('lyrics_header',elementTextareaHeader.value);});elementTextareaFooter.addEventListener('input',()=>{if(!settings.lyricsIsPlaying){(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);}storageSave('lyrics_footer',elementTextareaFooter.value);});elementInputOffset.addEventListener('input',()=>{if(!settings.lyricsIsPlaying){(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);}});elementInputBackground.addEventListener('change',event=>{const file=event.target.files&&event.target.files[0];settings.lyricsBackground=null;if(!file){return;};const url=URL.createObjectURL(file);if(file.type.startsWith('image/')){const fileImage=new Image();fileImage.src=url;fileImage.onload=()=>{settings.lyricsBackground={type:'image',el:fileImage};(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);};}else if(file.type.startsWith('video/')){const fileVideo=document.createElement('video');fileVideo.src=url;fileVideo.muted=true;fileVideo.loop=true;fileVideo.playsInline=true;fileVideo.onloadeddata=()=>{fileVideo.play().catch(error=>{console.log('Error playing video:',error);});settings.lyricsBackground={type:'video',el:fileVideo};(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);};fileVideo.load();}});elementButtonExport.addEventListener('click',async()=>{if(!elementAudio.src){alert('Please load an audio file first.');return;}const duration=elementAudio.duration;if(!isFinite(duration)||duration<=0){alert('Audio duration unknown â€” play once then try export.');return;}elementButtonExport.disabled=true;elementButtonExport.textContent='Recordingâ€¦';settings.lyricsIsRecording=true;try{await (0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsGetAudio)(elementAudio);const canvas=document.createElement('canvas');canvas.width=settings.lyricsPreviewWidth;canvas.height=settings.lyricsPreviewHeight;const cctx=canvas.getContext('2d',{alpha:true,desynchronized:true});const canvasStream=canvas.captureStream(settings.lyricsFPS);let audioStream=null;if(typeof elementAudio.captureStream==='function'){try{audioStream=elementAudio.captureStream();}catch(error){console.log('Error capturing audio stream:',error);audioStream=null;}}const composed=new MediaStream();canvasStream.getVideoTracks().forEach(t=>composed.addTrack(t));if(audioStream&&audioStream.getAudioTracks().length){audioStream.getAudioTracks().forEach(t=>composed.addTrack(t));}else{const audioCtx=new(window.AudioContext||window.webkitAudioContext)();const src=audioCtx.createMediaElementSource(elementAudio);const dest=audioCtx.createMediaStreamDestination();src.connect(dest);src.connect(audioCtx.destination);dest.stream.getAudioTracks().forEach(t=>composed.addTrack(t));}const mimeChoices=['video/webm;codecs=vp9,opus','video/webm;codecs=vp8,opus','video/webm'];let recorder;for(const m of mimeChoices){try{recorder=new MediaRecorder(composed,{mimeType:m});break;}catch(error){console.log(`MediaRecorder with mimeType \"${m}\" failed:`,error);recorder=null;}}if(!recorder){recorder=new MediaRecorder(composed);};const chunks=[];recorder.ondataavailable=ev=>{if(ev.data&&ev.data.size){chunks.push(ev.data);};};recorder.onstop=()=>{const blob=new Blob(chunks,{type:'video/webm'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`${settings.lyricsFileName}.webm`;a.click();URL.revokeObjectURL(url);elementButtonExport.disabled=false;elementButtonExport.textContent='Export';settings.lyricsIsRecording=false;};recorder.start();elementAudio.currentTime=0;await elementAudio.play();const frameInterval=Math.round(1000/settings.lyricsFPS);const renderInterval=setInterval(()=>{(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,cctx);if(elementAudio.ended||elementAudio.currentTime>=elementAudio.duration-0.05){try{recorder.stop();}catch(error){console.log('Error stopping recorder:',error);}clearInterval(renderInterval);elementAudio.pause();}},frameInterval);}catch(error){console.log(error);alert('Export failed: '+(error&&error.message?error.message:error));elementButtonExport.disabled=false;elementButtonExport.textContent='Record';settings.lyricsIsRecording=false;}});elementInputSpectrum.addEventListener('change',event=>{settings.lyricsRenderSpectrum=event.target.checked;if(!settings.lyricsIsPlaying){(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext);}});elementAudio.addEventListener('play',event=>{event.preventDefault();if(settings.lyricsRequestAnimationFrameID){cancelAnimationFrame(settings.lyricsRequestAnimationFrameID);};settings.lyricsRequestAnimationFrameID=requestAnimationFrame(_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRenderLoop);settings.lyricsIsPlaying=true;});elementAudio.addEventListener('pause',event=>{event.preventDefault();if(settings.lyricsRequestAnimationFrameID){cancelAnimationFrame(settings.lyricsRequestAnimationFrameID);settings.lyricsRequestAnimationFrameID=null;settings.lyricsIsPlaying=false;};});elementAudio.addEventListener('seeked',()=>(0,_modules_lyricsRender__WEBPACK_IMPORTED_MODULE_1__.lyricsRender)(elementAudio.currentTime*1000,settings.lyricsContext));window.addEventListener('beforeunload',event=>{if(settings.lyricsIsRecording){event.preventDefault();event.returnValue='';return'';}});\n\n//# sourceURL=webpack://lyrics-player/./src/scripts/script.js?\n}")}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./src/scripts/script.js")})();